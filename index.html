<html>
<body>
    <style>
        #outgoing {
            width: 600px;
            word-wrap: break-word;
            white-space: normal;
            border: 1px solid #ccc;
            padding: 10px;
            min-height: 100px;
        }
        #status {
            margin: 10px 0;
            font-weight: bold;
        }
    </style>
    <div id="status">Connecting...</div>
    <form>
        <textarea id="incoming" placeholder="Enter message"></textarea>
        <button type="submit">Send</button>
    </form>
    <h3>Received content:</h3>
    <pre id="outgoing"></pre>
    
    <script src="https://unpkg.com/peerjs@1.5.5/dist/peerjs.min.js"></script>
    <script>
        const statusDiv = document.getElementById('status');
        const outgoing = document.getElementById('outgoing');
        const socket = new WebSocket("wss://my-api-test-domen.pp.ua");
        const peer = new Peer();
        let conn;

        peer.on('open', (id) => {
            console.log(`üÜî My Peer ID: ${id}`);
            statusDiv.textContent = `Peer ready. ID: ${id}`;
        });

        socket.addEventListener("open", () => {
            console.log('‚úÖ WebSocket connected');
            statusDiv.textContent = 'Requesting server peer ID...';
            
            socket.send(JSON.stringify({
                role: "client",
                name: "bogdan",
                requestTo: "bot_father"
            }));
            console.log('üì§ Sent registration request');
        });

        socket.addEventListener("message", (event) => {
            console.log('üì• Received server peer ID:', event.data);
            const msg = JSON.parse(event.data);
            
            if (msg.data) {
                statusDiv.textContent = 'Connecting to server peer...';
                
                // –ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ —Å–µ—Ä–≤–µ—Ä–Ω–æ–º—É peer
                const connectToPeer = () => {
                    conn = peer.connect(msg.data);
                    
                    conn.on('open', () => {
                        console.log('‚úÖ Connected to server peer!');
                        statusDiv.textContent = 'üéâ Connected! Ready to receive data.';
                    });
                    
                    conn.on('data', (data) => {
                        console.log('üì® Received data:', data);
                        outgoing.textContent = data;
                    });
                    
                    conn.on('close', () => {
                        console.log('üîå Connection closed');
                        statusDiv.textContent = 'Disconnected from server';
                    });
                    
                    conn.on('error', (err) => {
                        console.error('‚ùå Connection error:', err);
                        statusDiv.textContent = 'Connection error: ' + err;
                    });
                };
                
                if (peer.open) {
                    connectToPeer();
                } else {
                    peer.on('open', connectToPeer);
                }
            }
        });

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
        document.querySelector('form').addEventListener('submit', (e) => {
            e.preventDefault();
            if (conn && conn.open) {
                const message = document.getElementById('incoming').value;
                conn.send(message);
                console.log('üì§ Sent to server:', message);
            } else {
                console.warn('‚ö†Ô∏è Not connected to server');
                statusDiv.textContent = 'Not connected! Cannot send message.';
            }
        });

        peer.on('error', (err) => {
            console.error('‚ùå Peer error:', err);
            statusDiv.textContent = 'Peer error: ' + err;
        });

        socket.addEventListener('error', (err) => {
            console.error('‚ùå WebSocket error:', err);
            statusDiv.textContent = 'WebSocket connection error!';
        });
    </script>
</body>
</html>